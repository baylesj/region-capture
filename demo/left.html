<html>
  <head>
    <link rel="stylesheet" href="column.css" />
    <link rel="icon" href="data:;base64,=" />
  </head>
  <body>
    <div class="rowHeader">
      <h1>Content Area</h1>
    </div>
    <div class="rowContentHolder">
      <div id="div1" class="rowContentA" style="opacity: .99">
        <h1>Content 1</h1>
        <p id="animation1"></p>
      </div>
    </div>
    <!-- TODO: Why are these breaklines necessary? Why do the two rows overlap otherwise? -->
    <br /><br />
    <div class="rowContentHolder">
      <div id="div2" class="rowContentB">
        <h1>Content 2</h1>
        <p id="animation2"></p>
      </div>
    </div>
    <script>
      if (!navigator.mediaDevices.produceCropId) {
        // TODO: Display explanation and abort.
      }

      let animationCounter = 0;

      function animate(animation) {
        animation.innerHTML = `Poor man's Intellectual-Property-respecting animation frame #${animationCounter}.`;
      }

      setInterval(() => {
        ++animationCounter;
        animate(animation1);
        animate(animation2);
      }, 100);

      const broadcastChannel = new BroadcastChannel("region-capture-demo");
      broadcastChannel.onmessage = onBroadcastChannelMessage;

      function onBroadcastChannelMessage(serializedMessage) {
        const msg = JSON.parse(serializedMessage.data);
        if (msg.init) {
          init();
        }
      }

      function postCropID(cropID) {
        broadcastChannel.postMessage(JSON.stringify({ cropID: cropID }));
      }

      async function init() {
        postCropID(await navigator.mediaDevices.produceCropId(document.getElementById("div1")));
        postCropID(await navigator.mediaDevices.produceCropId(document.getElementById("div2")));
      }
    </script>
  </body>
</html>
